<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>超级管理员登录</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="login-page">
    <!-- 登录Logo -->
    <div class="login-logo">
        <span>管</span>
    </div>

    <!-- 登录标题 -->
    <h1 class="login-title">超级管理员平台</h1>
    <p class="login-subtitle">请使用管理员账号登录</p>

    <!-- 登录表单 -->
    <form id="loginForm" class="login-form">
        <div class="form-group">
            <label class="form-label" for="email">邮箱</label>
            <input type="email" id="email" class="form-input" placeholder="请输入管理员邮箱" required>
        </div>

        <div class="form-group">
            <label class="form-label" for="password">密码</label>
            <input type="password" id="password" class="form-input" placeholder="请输入密码" required>
        </div>

        <button type="submit" id="loginBtn" class="btn btn-primary login-btn">登录</button>

        <!-- 错误提示 -->
        <div id="errorMsg" style="margin-top: 16px; color: #ff3b30; font-size: 14px; text-align: center; display: none;"></div>
    </form>

    <script type="module">
        import { login } from './js/api.js';
        import { auth } from './js/auth.js';
        import { showToast } from './js/utils.js';

        // 页面加载时检查登录状态
        if (auth.isLoggedIn()) {
            window.location.href = 'dashboard.html';
        }

        // 登录表单提交
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            const errorMsg = document.getElementById('errorMsg');

            // 重置状态
            errorMsg.style.display = 'none';
            loginBtn.disabled = true;
            loginBtn.textContent = '登录中...';

            try {
                // 调用登录接口
                const result = await login(email, password);
                
                if (result.success) {
                    // 登录成功，跳转控制台
                    showToast('登录成功', 'success');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                } else {
                    // 显示错误
                    errorMsg.textContent = result.message;
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                errorMsg.textContent = '网络异常，请重试';
                errorMsg.style.display = 'block';
            } finally {
                // 恢复按钮状态
                loginBtn.disabled = false;
                loginBtn.textContent = '登录';
            }
        });
    </script>
</body>
</html>